{% extends "base.html" %}

{% block title %}K-POP Analytics ì›”ê°„ ë¦¬í¬íŠ¸ - {{ period_start.strftime('%Yë…„ %mì›”') }}{% endblock %}

{% block header %}
<h1>ğŸ“ˆ K-POP Analytics</h1>
<div class="subtitle">ì›”ê°„ ì „ëµ ë¦¬í¬íŠ¸ | {{ period_start.strftime('%Yë…„ %mì›”') }}</div>
{% endblock %}

{% block content %}
<!-- Executive Dashboard -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--primary-color);">ğŸ¯</span>
            ê²½ì˜ì§„ ëŒ€ì‹œë³´ë“œ
        </h2>
    </div>
    <div class="section-content">
        {% if summary_cards %}
        <div class="metric-cards">
            {% for card in summary_cards %}
            <div class="metric-card {{ card.status|default('neutral') }}">
                <div class="metric-value">
                    {{ card.value }}{% if card.unit %} {{ card.unit }}{% endif %}
                </div>
                <div class="metric-label">{{ card.title }}</div>
                {% if card.change %}
                <div class="metric-change {{ 'positive' if card.change > 0 else 'negative' }}">
                    {{ '+' if card.change > 0 else '' }}{{ card.change|round(1) }}%
                    <small style="opacity: 0.8;">vs. ì „ì›”</small>
                </div>
                {% endif %}
                {% if card.description %}
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px;">
                    {{ card.description }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Strategic Insights -->
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-top: 25px;">
            <div class="alert info">
                <strong>ğŸš€ ì„±ì¥ ë™ë ¥</strong><br>
                â€¢ ë””ì§€í„¸ í”Œë«í¼ í†µí•© ìˆ˜ìµì´ ì „ì›” ëŒ€ë¹„ {{ digital_revenue_growth|default(18.5) }}% ì¦ê°€<br>
                â€¢ ê¸€ë¡œë²Œ ì‹œì¥ ì§„ì¶œë¡œ í•´ì™¸ ìˆ˜ìµ {{ global_revenue_share|default(35) }}% ë‹¬ì„±<br>
                â€¢ ì‹ ê·œ ì•„í‹°ìŠ¤íŠ¸ ëŸ°ì¹­ìœ¼ë¡œ í¬íŠ¸í´ë¦¬ì˜¤ ë‹¤ì–‘í™” ê°€ì†
            </div>
            <div class="alert warning">
                <strong>âš¡ ì£¼ìš” ê³¼ì œ</strong><br>
                â€¢ ì¼ë¶€ ì•„í‹°ìŠ¤íŠ¸ì˜ êµ­ë‚´ ì‹œì¥ ì ìœ ìœ¨ í•˜ë½ (-{{ domestic_decline|default(2.3) }}%)<br>
                â€¢ ë§ˆì¼€íŒ… ë¹„ìš© ëŒ€ë¹„ íš¨ìœ¨ì„± ê°œì„  í•„ìš”<br>
                â€¢ ì½˜í…ì¸  ì œì‘ ë¦¬ë“œíƒ€ì„ ë‹¨ì¶• ìš”êµ¬
            </div>
        </div>
    </div>
</section>

<!-- Monthly Performance Analysis -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--success-color);">ğŸ“Š</span>
            ì›”ê°„ ì„±ê³¼ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        <!-- Growth Analysis Chart -->
        <div class="chart-container">
            <h4 style="margin-bottom: 15px; color: var(--text-primary);">ì›”ê°„ ì„±ì¥ë¥  ì¶”ì´</h4>
            <div id="monthlyGrowthChart" style="height: 400px;"></div>
        </div>

        <!-- Performance Matrix -->
        <div style="margin-top: 30px;">
            <h4 style="color: var(--text-primary); margin-bottom: 20px;">ì„±ê³¼ ë§¤íŠ¸ë¦­ìŠ¤</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                {% set metrics = [
                    {'category': 'ìˆ˜ìµì„±', 'current': 85, 'target': 90, 'status': 'good'},
                    {'category': 'ì‹œì¥ì ìœ ìœ¨', 'current': 12.8, 'target': 15.0, 'status': 'warning'},
                    {'category': 'ë¸Œëœë“œ ì¸ì§€ë„', 'current': 78, 'target': 75, 'status': 'excellent'},
                    {'category': 'íŒ¬ë² ì´ìŠ¤ ì„±ì¥', 'current': 15.2, 'target': 12.0, 'status': 'excellent'}
                ] %}
                {% for metric in metrics %}
                <div style="background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px;">
                    <div style="font-weight: 600; margin-bottom: 10px;">{{ metric.category }}</div>
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span style="font-size: 1.5rem; font-weight: 700; color: var(--primary-color);">
                            {{ metric.current }}%
                        </span>
                        <span style="font-size: 0.9rem; color: var(--text-secondary);">
                            ëª©í‘œ: {{ metric.target }}%
                        </span>
                    </div>
                    <div style="margin-top: 10px;">
                        {% set status_colors = {'excellent': 'success', 'good': 'primary', 'warning': 'warning'} %}
                        <span style="color: var(--{{ status_colors[metric.status] }}-color); font-size: 0.85rem; font-weight: 500;">
                            {% if metric.status == 'excellent' %}âœ… ëª©í‘œ ì´ˆê³¼ ë‹¬ì„±
                            {% elif metric.status == 'good' %}ğŸ‘ ì–‘í˜¸
                            {% else %}âš ï¸ ê°œì„  í•„ìš”
                            {% endif %}
                        </span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>

<!-- Artist Portfolio Analysis -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--secondary-color);">ğŸ¤</span>
            ì•„í‹°ìŠ¤íŠ¸ í¬íŠ¸í´ë¦¬ì˜¤ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        {% if top_performers %}
        <div style="margin-bottom: 30px;">
            <h4 style="color: var(--text-primary); margin-bottom: 15px;">ì´ë‹¬ì˜ ìŠ¤íƒ€ í¼í¬ë¨¸</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                {% for category, performers in top_performers.items() %}
                {% if performers %}
                <div style="background: var(--bg-secondary); padding: 20px; border-radius: 12px; border-left: 4px solid var(--primary-color);">
                    <h5 style="color: var(--primary-color); margin-bottom: 15px; text-transform: capitalize;">
                        {{ category|replace('_', ' ') }} ë¶€ë¬¸
                    </h5>
                    {% for performer in performers[:3] %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; {% if not loop.last %}border-bottom: 1px solid var(--border-color);{% endif %}">
                        <div>
                            <div style="font-weight: 600;">#{{ performer.rank }} {{ performer.entity_name }}</div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">{{ performer.entity_type }}</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: var(--primary-color);">
                                {{ performer.metric_value|round(1) }} {{ performer.metric_unit|default('') }}
                            </div>
                            {% if performer.change %}
                            <div class="metric-change {{ 'positive' if performer.change > 0 else 'negative' }}" style="font-size: 0.8rem;">
                                {{ '+' if performer.change > 0 else '' }}{{ performer.change|round(1) }}%
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Artist Performance Matrix -->
        <div class="chart-container">
            <h4 style="margin-bottom: 15px; color: var(--text-primary);">ì•„í‹°ìŠ¤íŠ¸ ì„±ê³¼ ë§¤íŠ¸ë¦­ìŠ¤ (ì„±ì¥ë¥  vs ìˆ˜ìµì„±)</h4>
            <div id="artistMatrixChart" style="height: 450px;"></div>
        </div>
    </div>
</section>

<!-- Market Analysis -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--accent-color);">ğŸŒ</span>
            ì‹œì¥ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 25px;">
            <!-- Geographic Performance -->
            <div>
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">ì§€ì—­ë³„ ì„±ê³¼</h4>
                <div id="geographicChart" style="height: 300px;"></div>
                <div style="margin-top: 15px;">
                    {% set regions = [
                        {'name': 'í•œêµ­', 'share': 45, 'growth': 2.1},
                        {'name': 'ì¼ë³¸', 'share': 25, 'growth': 5.8},
                        {'name': 'ë™ë‚¨ì•„ì‹œì•„', 'share': 15, 'growth': 18.2},
                        {'name': 'ë¶ë¯¸', 'share': 10, 'growth': 12.5},
                        {'name': 'ê¸°íƒ€', 'share': 5, 'growth': 8.7}
                    ] %}
                    <table class="data-table" style="font-size: 0.9rem;">
                        <thead>
                            <tr>
                                <th>ì§€ì—­</th>
                                <th>ì ìœ ìœ¨</th>
                                <th>ì„±ì¥ë¥ </th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for region in regions %}
                            <tr>
                                <td>{{ region.name }}</td>
                                <td>{{ region.share }}%</td>
                                <td class="metric-change {{ 'positive' if region.growth > 5 else 'neutral' }}">
                                    +{{ region.growth }}%
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Platform Distribution -->
            <div>
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">í”Œë«í¼ë³„ ë§¤ì¶œ êµ¬ì„±</h4>
                <div id="platformRevenueChart" style="height: 300px;"></div>
                <div style="margin-top: 15px;">
                    <div class="alert info">
                        <strong>ğŸ’¡ ì¸ì‚¬ì´íŠ¸</strong><br>
                        â€¢ ìŠ¤íŠ¸ë¦¬ë° ìˆ˜ìµì´ ì „ì²´ì˜ {{ streaming_share|default(58) }}% ì°¨ì§€<br>
                        â€¢ MD/êµ¿ì¦ˆ íŒë§¤ {{ merch_growth|default(23) }}% ì„±ì¥<br>
                        â€¢ ë¼ì´ë¸Œ ê³µì—° ìˆ˜ìµ íšŒë³µì„¸ ({{ live_recovery|default(45) }}%)
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Monthly Comparisons -->
{% if monthly_comparisons %}
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--primary-color);">ğŸ“ˆ</span>
            ì „ì›” ëŒ€ë¹„ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        <div class="metric-cards">
            {% for comparison_name, data in monthly_comparisons.items() %}
            <div class="metric-card {{ 'positive' if data.change > 0 else 'negative' if data.change < -2 else 'neutral' }}">
                <div class="metric-value">{{ data.current|round(1) }}%</div>
                <div class="metric-label">{{ comparison_name|replace('_', ' ')|title }}</div>
                <div class="metric-change {{ 'positive' if data.change > 0 else 'negative' }}">
                    {{ '+' if data.change > 0 else '' }}{{ data.change|round(1) }}%p
                    <small style="opacity: 0.8;">ì „ì›”: {{ data.previous|round(1) }}%</small>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>
{% endif %}

<!-- Action Items & Recommendations -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--accent-color);">ğŸ¯</span>
            ì‹¤í–‰ ê³„íš & ê¶Œì¥ì‚¬í•­
        </h2>
    </div>
    <div class="section-content">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
            <div>
                <h4 style="color: var(--success-color); margin-bottom: 15px;">âœ… ì´ë²ˆ ë‹¬ ì„±ê³¼</h4>
                <ul style="list-style-type: none; padding: 0;">
                    <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <strong>ì‹ ê·œ ì•„í‹°ìŠ¤íŠ¸ ë°ë·”</strong> - ì²« ì£¼ ì°¨íŠ¸ ì§„ì… ì„±ê³µ
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <strong>ê¸€ë¡œë²Œ íˆ¬ì–´</strong> - 12ê°œ ë„ì‹œ ë§¤ì§„ ê¸°ë¡
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <strong>ìŠ¤íŠ¸ë¦¬ë° ê¸°ë¡</strong> - ì›”ê°„ 10ì–µ ì¬ìƒ ëŒíŒŒ
                    </li>
                    <li style="padding: 8px 0;">
                        <strong>ë¸Œëœë“œ íŒŒíŠ¸ë„ˆì‹­</strong> - 3ê°œ ë©”ì´ì € ë¸Œëœë“œ ê³„ì•½
                    </li>
                </ul>
            </div>

            <div>
                <h4 style="color: var(--warning-color); margin-bottom: 15px;">ğŸ¯ ë‹¤ìŒ ë‹¬ ëª©í‘œ</h4>
                <ul style="list-style-type: none; padding: 0;">
                    <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <strong>ì‹œì¥ ì ìœ ìœ¨</strong> - êµ­ë‚´ 15%, í•´ì™¸ 8% ëª©í‘œ
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <strong>ì½˜í…ì¸  ì œì‘</strong> - í”„ë¦¬ë¯¸ì—„ ì½˜í…ì¸  3í¸ ì œì‘
                    </li>
                    <li style="padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <strong>í”Œë«í¼ í™•ì¥</strong> - ìƒˆë¡œìš´ ì†Œì…œ í”Œë«í¼ ì§„ì¶œ
                    </li>
                    <li style="padding: 8px 0;">
                        <strong>ìˆ˜ìµ ë‹¤ê°í™”</strong> - NFT/ë©”íƒ€ë²„ìŠ¤ ì‚¬ì—… ë¡ ì¹­
                    </li>
                </ul>
            </div>
        </div>

        <div style="margin-top: 25px; padding: 20px; background: var(--bg-secondary); border-radius: 8px; border-left: 4px solid var(--primary-color);">
            <h4 style="color: var(--primary-color); margin-bottom: 15px;">ğŸš€ ì „ëµì  ê¶Œì¥ì‚¬í•­</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                <div>
                    <strong>1. ë°ì´í„° ê¸°ë°˜ ì˜ì‚¬ê²°ì • ê°•í™”</strong><br>
                    <small style="color: var(--text-secondary);">
                        AI/ML ê¸°ë°˜ íŒ¬ í–‰ë™ ë¶„ì„ìœ¼ë¡œ ì½˜í…ì¸  ì „ëµ ìµœì í™”
                    </small>
                </div>
                <div>
                    <strong>2. ê¸€ë¡œë²Œ ì‹œì¥ ì§„ì¶œ ê°€ì†í™”</strong><br>
                    <small style="color: var(--text-secondary);">
                        ë™ë‚¨ì•„ì‹œì•„ ì‹œì¥ ìš°ì„  ê³µëµ, í˜„ì§€ íŒŒíŠ¸ë„ˆì‹­ í™•ëŒ€
                    </small>
                </div>
                <div>
                    <strong>3. ì°¨ì„¸ëŒ€ í”Œë«í¼ ëŒ€ì‘</strong><br>
                    <small style="color: var(--text-secondary);">
                        ë©”íƒ€ë²„ìŠ¤, AR/VR ì½˜í…ì¸  ì œì‘ ì—­ëŸ‰ í™•ë³´
                    </small>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Monthly Growth Chart
    const monthlyGrowthData = [{
        x: ['1ì£¼ì°¨', '2ì£¼ì°¨', '3ì£¼ì°¨', '4ì£¼ì°¨'],
        y: [12.5, 15.2, 18.7, 16.3],
        type: 'scatter',
        mode: 'lines+markers',
        name: 'ì£¼ê°„ ì„±ì¥ë¥ ',
        line: { color: '#6366f1', width: 3 },
        marker: { size: 10, color: '#ec4899' }
    }, {
        x: ['1ì£¼ì°¨', '2ì£¼ì°¨', '3ì£¼ì°¨', '4ì£¼ì°¨'],
        y: [10.1, 11.8, 13.2, 12.9],
        type: 'scatter',
        mode: 'lines+markers',
        name: 'ì—…ê³„ í‰ê· ',
        line: { color: '#9ca3af', width: 2, dash: 'dash' },
        marker: { size: 8, color: '#9ca3af' }
    }];

    const monthlyGrowthLayout = {
        title: { text: 'ì£¼ê°„ë³„ ì„±ì¥ë¥  ë¹„êµ (%)', font: { size: 16 } },
        xaxis: { title: 'ì£¼ì°¨' },
        yaxis: { title: 'ì„±ì¥ë¥  (%)' },
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 50, r: 30, b: 50, l: 60 }
    };

    if (document.getElementById('monthlyGrowthChart')) {
        Plotly.newPlot('monthlyGrowthChart', monthlyGrowthData, monthlyGrowthLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Artist Matrix Chart
    const artistMatrixData = [{
        x: [5.2, 12.8, 8.1, 15.3, 6.7, 18.9, 3.4, 22.1],
        y: [85, 92, 78, 96, 88, 89, 72, 94],
        mode: 'markers+text',
        type: 'scatter',
        text: ['Artist A', 'Artist B', 'Artist C', 'Artist D', 'Artist E', 'Artist F', 'Artist G', 'Artist H'],
        textposition: 'top center',
        marker: {
            size: [15, 18, 12, 20, 14, 22, 10, 25],
            color: ['#6366f1', '#ec4899', '#f59e0b', '#10b981', '#6366f1', '#ec4899', '#f59e0b', '#10b981'],
            opacity: 0.7
        }
    }];

    const artistMatrixLayout = {
        title: { text: 'ì•„í‹°ìŠ¤íŠ¸ ì„±ê³¼ ë§¤íŠ¸ë¦­ìŠ¤', font: { size: 16 } },
        xaxis: { title: 'ì„±ì¥ë¥  (%)' },
        yaxis: { title: 'ìˆ˜ìµì„± ì ìˆ˜' },
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 50, r: 30, b: 60, l: 70 }
    };

    if (document.getElementById('artistMatrixChart')) {
        Plotly.newPlot('artistMatrixChart', artistMatrixData, artistMatrixLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Geographic Chart (Pie)
    const geographicData = [{
        values: [45, 25, 15, 10, 5],
        labels: ['í•œêµ­', 'ì¼ë³¸', 'ë™ë‚¨ì•„ì‹œì•„', 'ë¶ë¯¸', 'ê¸°íƒ€'],
        type: 'pie',
        marker: {
            colors: ['#6366f1', '#ec4899', '#f59e0b', '#10b981', '#8b5cf6']
        },
        textinfo: 'label+percent',
        textposition: 'outside'
    }];

    const geographicLayout = {
        title: { text: 'ì§€ì—­ë³„ ë§¤ì¶œ êµ¬ì„±', font: { size: 14 } },
        showlegend: false,
        margin: { t: 50, r: 30, b: 30, l: 30 }
    };

    if (document.getElementById('geographicChart')) {
        Plotly.newPlot('geographicChart', geographicData, geographicLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Platform Revenue Chart
    const platformRevenueData = [{
        values: [58, 22, 12, 8],
        labels: ['ìŠ¤íŠ¸ë¦¬ë°', 'MD/êµ¿ì¦ˆ', 'ë¼ì´ë¸Œ', 'ê¸°íƒ€'],
        type: 'pie',
        hole: 0.4,
        marker: {
            colors: ['#1db954', '#ff6b6b', '#4ecdc4', '#ffa726']
        },
        textinfo: 'label+percent',
        textposition: 'outside'
    }];

    const platformRevenueLayout = {
        title: { text: 'ìˆ˜ìµì›ë³„ êµ¬ì„±', font: { size: 14 } },
        showlegend: false,
        margin: { t: 50, r: 30, b: 30, l: 30 }
    };

    if (document.getElementById('platformRevenueChart')) {
        Plotly.newPlot('platformRevenueChart', platformRevenueData, platformRevenueLayout, {
            responsive: true, displayModeBar: false
        });
    }
});
</script>
{% endblock %}