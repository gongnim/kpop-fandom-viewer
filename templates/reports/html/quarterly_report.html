{% extends "base.html" %}

{% block title %}K-POP Analytics ë¶„ê¸° ì „ëµ ë¦¬í¬íŠ¸ - {{ period_start.strftime('%Yë…„ Q%q') }}{% endblock %}

{% block header %}
<h1>ğŸ† K-POP Analytics</h1>
<div class="subtitle">ë¶„ê¸° ì „ëµ ë¦¬í¬íŠ¸ | {{ period_start.strftime('%Yë…„') }} Q{{ ((period_start.month - 1) // 3 + 1) }}</div>
{% endblock %}

{% block content %}
<!-- Executive Summary -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--primary-color);">ğŸ¯</span>
            CEO ìš”ì•½ ë¸Œë¦¬í•‘
        </h2>
    </div>
    <div class="section-content">
        {% if executive_summary %}
        <div style="background: var(--gradient-primary); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
            <h3 style="margin-bottom: 20px; font-size: 1.3rem;">í•µì‹¬ ì„±ê³¼ ìš”ì•½</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">{{ quarter_revenue|default('â‚©187B') }}</div>
                    <div style="opacity: 0.9;">ë¶„ê¸° ë§¤ì¶œ</div>
                    <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">ì „ë¶„ê¸° ëŒ€ë¹„ +{{ quarter_growth|default(15.2) }}%</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">{{ market_rank|default('#3') }}</div>
                    <div style="opacity: 0.9;">ì—…ê³„ ìˆœìœ„</div>
                    <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">{{ rank_change|default('+1') }} ë‹¨ê³„ ìƒìŠ¹</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">{{ global_expansion|default('12') }}</div>
                    <div style="opacity: 0.9;">ì‹ ê·œ ì§„ì¶œêµ­</div>
                    <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">ëˆ„ì  {{ total_countries|default(28) }}ê°œêµ­</div>
                </div>
                <div style="text-align: center;">
                    <div style="font-size: 2rem; font-weight: 700; margin-bottom: 5px;">{{ artist_debuts|default('3') }}</div>
                    <div style="opacity: 0.9;">ì‹ ê·œ ë°ë·”</div>
                    <div style="font-size: 0.9rem; margin-top: 5px; opacity: 0.8;">ì„±ê³µë¥  {{ debut_success|default(100) }}%</div>
                </div>
            </div>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
            <div class="alert info">
                <strong>ğŸš€ ì£¼ìš” ì„±ì·¨</strong><br>
                {% if executive_summary.key_achievements %}
                {% for achievement in executive_summary.key_achievements %}
                â€¢ {{ achievement }}<br>
                {% endfor %}
                {% else %}
                â€¢ í¬íŠ¸í´ë¦¬ì˜¤ ê°€ì¹˜ 15.2% ì¦ê°€ë¡œ ì—­ëŒ€ ìµœê³  ê¸°ë¡<br>
                â€¢ ê¸€ë¡œë²Œ ì‹œì¥ ì§„ì¶œë¡œ í•´ì™¸ ë§¤ì¶œ 35% ë‹¬ì„±<br>
                â€¢ ì‹ ê·œ ì•„í‹°ìŠ¤íŠ¸ 3íŒ€ ì„±ê³µì  ë°ë·”
                {% endif %}
            </div>
            <div class="alert warning">
                <strong>ğŸ¯ í•µì‹¬ ì¸ì‚¬ì´íŠ¸</strong><br>
                {% if executive_summary.critical_insights %}
                {% for insight in executive_summary.critical_insights %}
                â€¢ {{ insight }}<br>
                {% endfor %}
                {% else %}
                â€¢ ë””ì§€í„¸ í”Œë«í¼ ì¤‘ì‹¬ì˜ ìˆ˜ìµ êµ¬ì¡° ì „í™˜ ê°€ì†í™”<br>
                â€¢ ë™ë‚¨ì•„ì‹œì•„ ì‹œì¥ì—ì„œ í­ë°œì  ì„±ì¥ ê¸°íšŒ í¬ì°©<br>
                â€¢ ë°ì´í„° ê¸°ë°˜ ì•„í‹°ìŠ¤íŠ¸ ê°œë°œë¡œ ì„±ê³µë¥  í–¥ìƒ
                {% endif %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Strategic KPIs -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--success-color);">ğŸ“Š</span>
            ì „ëµì  KPI ëŒ€ì‹œë³´ë“œ
        </h2>
    </div>
    <div class="section-content">
        {% if summary_cards %}
        <div class="metric-cards">
            {% for card in summary_cards %}
            <div class="metric-card {{ card.status|default('neutral') }}">
                <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
                    <div class="metric-label">{{ card.title }}</div>
                    {% if card.status == 'positive' %}
                    <span style="color: var(--success-color); font-size: 1.2rem;">ğŸ“ˆ</span>
                    {% elif card.status == 'negative' %}
                    <span style="color: var(--error-color); font-size: 1.2rem;">ğŸ“‰</span>
                    {% else %}
                    <span style="color: var(--warning-color); font-size: 1.2rem;">â¡ï¸</span>
                    {% endif %}
                </div>
                <div class="metric-value">
                    {{ card.value }}{% if card.unit %} {{ card.unit }}{% endif %}
                </div>
                {% if card.change %}
                <div class="metric-change {{ 'positive' if card.change > 0 else 'negative' }}">
                    {{ '+' if card.change > 0 else '' }}{{ card.change|round(1) }}%
                    <small style="opacity: 0.8;">vs. ì „ë¶„ê¸°</small>
                </div>
                {% endif %}
                {% if card.description %}
                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 8px; line-height: 1.4;">
                    {{ card.description }}
                </div>
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Strategic Performance Matrix -->
        <div style="margin-top: 30px;">
            <h4 style="color: var(--text-primary); margin-bottom: 20px;">ì „ëµì  ì„±ê³¼ ë§¤íŠ¸ë¦­ìŠ¤</h4>
            <div class="chart-container">
                <div id="strategicMatrixChart" style="height: 500px;"></div>
            </div>
        </div>
    </div>
</section>

<!-- Market Position Analysis -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--accent-color);">ğŸŒ</span>
            ì‹œì¥ í¬ì§€ì…˜ & ê²½ìŸ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px;">
            <!-- Market Share Evolution -->
            <div>
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">ì‹œì¥ ì ìœ ìœ¨ ë³€í™”</h4>
                <div id="marketShareChart" style="height: 300px;"></div>
            </div>

            <!-- Competitive Landscape -->
            <div>
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">ê²½ìŸì‚¬ ëŒ€ë¹„ í¬ì§€ì…˜</h4>
                <div id="competitorChart" style="height: 300px;"></div>
            </div>
        </div>

        {% if strategic_insights %}
        <div style="background: var(--bg-secondary); padding: 25px; border-radius: 12px; border-left: 4px solid var(--primary-color);">
            <h4 style="color: var(--primary-color); margin-bottom: 20px;">ì „ëµì  ì‹œì¥ ë¶„ì„</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                <div>
                    <h5 style="color: var(--success-color); margin-bottom: 10px;">ğŸ¯ ì‹œì¥ í¬ì§€ì…˜</h5>
                    <div style="font-size: 0.9rem; line-height: 1.6; color: var(--text-secondary);">
                        í˜„ì¬ ì—…ê³„ {{ strategic_insights.market_position.current_rank }}ìœ„ (ì „ë¶„ê¸° ëŒ€ë¹„ {{ strategic_insights.market_position.change_from_last_quarter|abs }}ë‹¨ê³„ {{ 'ìƒìŠ¹' if strategic_insights.market_position.change_from_last_quarter > 0 else 'í•˜ë½' }})<br>
                        ì‹œì¥ ì ìœ ìœ¨: {{ strategic_insights.market_position.market_share_percent }}%
                    </div>
                </div>
                <div>
                    <h5 style="color: var(--accent-color); margin-bottom: 10px;">ğŸš€ ì„±ì¥ ê¸°íšŒ</h5>
                    <ul style="font-size: 0.9rem; line-height: 1.6; color: var(--text-secondary); margin: 0; padding-left: 18px;">
                        {% for opportunity in strategic_insights.growth_opportunities %}
                        <li>{{ opportunity }}</li>
                        {% endfor %}
                    </ul>
                </div>
                <div>
                    <h5 style="color: var(--warning-color); margin-bottom: 10px;">âš ï¸ ìœ„í—˜ ìš”ì†Œ</h5>
                    <ul style="font-size: 0.9rem; line-height: 1.6; color: var(--text-secondary); margin: 0; padding-left: 18px;">
                        {% for risk in strategic_insights.risk_factors %}
                        <li>{{ risk }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Portfolio Performance Analysis -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--secondary-color);">ğŸ¤</span>
            í¬íŠ¸í´ë¦¬ì˜¤ ì„±ê³¼ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        <!-- Artist Performance Heatmap -->
        <div class="chart-container">
            <h4 style="margin-bottom: 15px; color: var(--text-primary);">ì•„í‹°ìŠ¤íŠ¸ë³„ ì„±ê³¼ íˆíŠ¸ë§µ</h4>
            <div id="performanceHeatmapChart" style="height: 400px;"></div>
        </div>

        {% if top_performers %}
        <!-- Top Performers by Category -->
        <div style="margin-top: 30px;">
            <h4 style="color: var(--text-primary); margin-bottom: 20px;">ë¶„ê¸° MVP ì•„í‹°ìŠ¤íŠ¸</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px;">
                {% for category, performers in top_performers.items() %}
                {% if performers %}
                <div style="background: white; border: 1px solid var(--border-color); border-radius: 12px; padding: 20px;">
                    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
                        <h5 style="color: var(--primary-color); margin: 0; text-transform: capitalize;">
                            {{ category|replace('_', ' ') }} ìµœê³  ì„±ê³¼
                        </h5>
                        <span style="background: var(--primary-color); color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">
                            TOP {{ performers|length }}
                        </span>
                    </div>
                    {% for performer in performers[:3] %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 12px 0; {% if not loop.last %}border-bottom: 1px solid var(--border-color);{% endif %}">
                        <div>
                            <div style="font-weight: 600; color: var(--text-primary);">
                                ğŸ† {{ performer.entity_name }}
                            </div>
                            <div style="font-size: 0.85rem; color: var(--text-secondary);">
                                {{ performer.entity_type }} â€¢ #{{ performer.rank }} ìˆœìœ„
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: var(--primary-color); font-size: 1.1rem;">
                                {{ performer.metric_value|round(1) }}{{ performer.metric_unit|default('') }}
                            </div>
                            {% if performer.change %}
                            <div class="metric-change {{ 'positive' if performer.change > 0 else 'negative' }}" style="font-size: 0.8rem;">
                                {{ '+' if performer.change > 0 else '' }}{{ performer.change|round(1) }}%
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
        {% endif %}
    </div>
</section>

<!-- Financial Performance -->
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--success-color);">ğŸ’°</span>
            ì¬ë¬´ ì„±ê³¼ ë¶„ì„
        </h2>
    </div>
    <div class="section-content">
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">
            <!-- Revenue Trend -->
            <div>
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">ë¶„ê¸°ë³„ ë§¤ì¶œ ì¶”ì´</h4>
                <div id="revenueChart" style="height: 350px;"></div>
            </div>

            <!-- Revenue Structure -->
            <div>
                <h4 style="color: var(--text-primary); margin-bottom: 15px;">ë§¤ì¶œ êµ¬ì¡°</h4>
                <div id="revenueStructureChart" style="height: 300px;"></div>
                <div style="margin-top: 15px;">
                    {% set revenue_items = [
                        {'source': 'ìŒì›/ìŠ¤íŠ¸ë¦¬ë°', 'amount': 'â‚©108B', 'share': 58, 'growth': 12.5},
                        {'source': 'MD/êµ¿ì¦ˆ', 'amount': 'â‚©41B', 'share': 22, 'growth': 28.3},
                        {'source': 'ê³µì—°/íˆ¬ì–´', 'amount': 'â‚©22B', 'share': 12, 'growth': -5.2},
                        {'source': 'ê´‘ê³ /í˜‘ì°¬', 'amount': 'â‚©16B', 'share': 8, 'growth': 45.8}
                    ] %}
                    {% for item in revenue_items %}
                    <div style="display: flex; justify-content: space-between; align-items: center; padding: 8px 0; border-bottom: 1px solid var(--border-color);">
                        <div>
                            <div style="font-weight: 600; font-size: 0.9rem;">{{ item.source }}</div>
                            <div style="font-size: 0.8rem; color: var(--text-secondary);">{{ item.share }}% êµ¬ì„±</div>
                        </div>
                        <div style="text-align: right;">
                            <div style="font-weight: 600; color: var(--primary-color);">{{ item.amount }}</div>
                            <div class="metric-change {{ 'positive' if item.growth > 0 else 'negative' }}" style="font-size: 0.8rem;">
                                {{ '+' if item.growth > 0 else '' }}{{ item.growth }}%
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Strategic Initiatives & Next Quarter -->
{% if strategic_analysis %}
<section class="section">
    <div class="section-header">
        <h2 class="section-title">
            <span style="color: var(--primary-color);">ğŸ¯</span>
            ì „ëµì  ì´ë‹ˆì…”í‹°ë¸Œ & ì°¨ë¶„ê¸° ê³„íš
        </h2>
    </div>
    <div class="section-content">
        <div style="background: var(--gradient-secondary); color: white; padding: 25px; border-radius: 12px; margin-bottom: 25px;">
            <h3 style="margin-bottom: 15px;">ì°¨ë¶„ê¸° ì „ëµ ë°©í–¥</h3>
            <p style="font-size: 1.1rem; line-height: 1.6; opacity: 0.95;">
                {{ strategic_analysis.portfolio_performance|default('ë°ì´í„° ê¸°ë°˜ ì•„í‹°ìŠ¤íŠ¸ ê°œë°œê³¼ ê¸€ë¡œë²Œ ì‹œì¥ í™•ì¥ì„ í†µí•´ ì§€ì† ê°€ëŠ¥í•œ ì„±ì¥ ê¸°ë°˜ì„ êµ¬ì¶•í•˜ê² ìŠµë‹ˆë‹¤.') }}
            </p>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
            <div class="alert info">
                <strong>ğŸ¯ íˆ¬ì ìš°ì„ ìˆœìœ„</strong><br>
                {% if strategic_analysis.investment_recommendations %}
                {% for recommendation in strategic_analysis.investment_recommendations %}
                â€¢ {{ recommendation }}<br>
                {% endfor %}
                {% else %}
                â€¢ ì‹ ì¸ ì•„í‹°ìŠ¤íŠ¸ ë°œêµ´ ë° íŠ¸ë ˆì´ë‹<br>
                â€¢ ê¸€ë¡œë²Œ ë§ˆì¼€íŒ… ì—­ëŸ‰ ê°•í™”<br>
                â€¢ ë””ì§€í„¸ í”Œë«í¼ ê¸°ìˆ  íˆ¬ì
                {% endif %}
            </div>
            
            <div class="alert warning">
                <strong>âš¡ ì‹œì¥ íŠ¸ë Œë“œ</strong><br>
                {{ strategic_analysis.market_trends|default('K-POP ê¸€ë¡œë²Œ í™•ì‚°ìœ¼ë¡œ ìƒˆë¡œìš´ ì„±ì¥ ê¸°íšŒ ì°½ì¶œ') }}<br>
                ë©”íƒ€ë²„ìŠ¤ì™€ NFT ë“± ì‹ ê¸°ìˆ  í™œìš© í™•ëŒ€<br>
                ê°œì¸í™”ëœ íŒ¬ ê²½í—˜ ì¤‘ì‹œ íŠ¸ë Œë“œ ê°•í™”
            </div>
            
            <div class="alert info">
                <strong>ğŸ† ê²½ìŸ ìš°ìœ„</strong><br>
                {{ strategic_analysis.competitive_landscape|default('ë°ì´í„° ë¶„ì„ ê¸°ë°˜ ì•„í‹°ìŠ¤íŠ¸ ê°œë°œë¡œ ì°¨ë³„í™”') }}<br>
                ë©€í‹° í”Œë«í¼ í†µí•© ë§ˆì¼€íŒ… ì—­ëŸ‰<br>
                ê¸€ë¡œë²Œ ë„¤íŠ¸ì›Œí¬ ë° íŒŒíŠ¸ë„ˆì‹­
            </div>
        </div>

        <!-- Action Items Matrix -->
        <div style="margin-top: 30px;">
            <h4 style="color: var(--text-primary); margin-bottom: 20px;">ì°¨ë¶„ê¸° ì‹¤í–‰ ê³„íš ë§¤íŠ¸ë¦­ìŠ¤</h4>
            {% if executive_summary and executive_summary.action_items %}
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 15px;">
                {% for action in executive_summary.action_items %}
                <div style="background: white; border: 1px solid var(--border-color); border-radius: 8px; padding: 20px; border-left: 4px solid var(--primary-color);">
                    <div style="font-weight: 600; color: var(--primary-color); margin-bottom: 10px;">
                        ì•¡ì…˜ ì•„ì´í…œ {{ loop.index }}
                    </div>
                    <div style="font-size: 0.95rem; line-height: 1.6;">
                        {{ action }}
                    </div>
                    <div style="margin-top: 12px; display: flex; justify-content: space-between; align-items: center; font-size: 0.85rem;">
                        <span style="color: var(--text-secondary);">ìš°ì„ ìˆœìœ„: 
                            {% if loop.index <= 2 %}
                            <span style="color: var(--error-color);">ë†’ìŒ</span>
                            {% else %}
                            <span style="color: var(--warning-color);">ë³´í†µ</span>
                            {% endif %}
                        </span>
                        <span style="color: var(--text-secondary);">ëª©í‘œ: {{ 'Q' ~ (((period_start.month - 1) // 3 + 2) % 4 + 1) }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Strategic Matrix Chart (Growth vs Profitability)
    const strategicMatrixData = [{
        x: [15, 28, 12, 35, 18, 42, 8, 25],
        y: [85, 92, 78, 96, 88, 94, 72, 89],
        mode: 'markers+text',
        type: 'scatter',
        text: ['ì•„í‹°ìŠ¤íŠ¸A', 'ì•„í‹°ìŠ¤íŠ¸B', 'ì•„í‹°ìŠ¤íŠ¸C', 'ì•„í‹°ìŠ¤íŠ¸D', 'ì•„í‹°ìŠ¤íŠ¸E', 'ì•„í‹°ìŠ¤íŠ¸F', 'ì•„í‹°ìŠ¤íŠ¸G', 'ì•„í‹°ìŠ¤íŠ¸H'],
        textposition: 'top center',
        marker: {
            size: [20, 28, 15, 35, 22, 40, 12, 25],
            color: [85, 92, 78, 96, 88, 94, 72, 89],
            colorscale: [
                [0, '#ff4444'], [0.5, '#ffaa00'], [1, '#00cc88']
            ],
            showscale: true,
            colorbar: {title: 'ìˆ˜ìµì„± ì ìˆ˜'}
        }
    }];

    const strategicMatrixLayout = {
        title: { text: 'ì „ëµì  í¬íŠ¸í´ë¦¬ì˜¤ ë§¤íŠ¸ë¦­ìŠ¤ (ì„±ì¥ë¥  vs ìˆ˜ìµì„±)', font: { size: 16 } },
        xaxis: { title: 'ì„±ì¥ë¥  (%)', range: [0, 50] },
        yaxis: { title: 'ìˆ˜ìµì„± ì ìˆ˜', range: [60, 100] },
        annotations: [
            {x: 12.5, y: 95, text: 'ìŠ¤íƒ€', showarrow: false, font: {size: 12, color: '#00cc88'}},
            {x: 37.5, y: 95, text: 'ì„±ì¥ ë™ë ¥', showarrow: false, font: {size: 12, color: '#00cc88'}},
            {x: 12.5, y: 70, text: 'ê´€ë¦¬ í•„ìš”', showarrow: false, font: {size: 12, color: '#ff4444'}},
            {x: 37.5, y: 70, text: 'íˆ¬ì ê¸°íšŒ', showarrow: false, font: {size: 12, color: '#ffaa00'}}
        ],
        shapes: [
            {type: 'line', x0: 25, x1: 25, y0: 60, y1: 100, line: {dash: 'dash', color: '#ccc'}},
            {type: 'line', x0: 0, x1: 50, y0: 80, y1: 80, line: {dash: 'dash', color: '#ccc'}}
        ],
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 60, r: 30, b: 70, l: 70 }
    };

    if (document.getElementById('strategicMatrixChart')) {
        Plotly.newPlot('strategicMatrixChart', strategicMatrixData, strategicMatrixLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Market Share Chart
    const marketShareData = [{
        x: ['Q1', 'Q2', 'Q3', 'Q4'],
        y: [10.2, 11.8, 12.8, 13.5],
        type: 'scatter',
        mode: 'lines+markers',
        name: 'ìš°ë¦¬ íšŒì‚¬',
        line: { color: '#6366f1', width: 4 },
        marker: { size: 10 }
    }, {
        x: ['Q1', 'Q2', 'Q3', 'Q4'],
        y: [18.5, 17.2, 16.8, 16.1],
        type: 'scatter',
        mode: 'lines+markers',
        name: 'ê²½ìŸì‚¬ A',
        line: { color: '#ef4444', width: 3 },
        marker: { size: 8 }
    }, {
        x: ['Q1', 'Q2', 'Q3', 'Q4'],
        y: [15.3, 15.8, 15.5, 15.2],
        type: 'scatter',
        mode: 'lines+markers',
        name: 'ê²½ìŸì‚¬ B',
        line: { color: '#f59e0b', width: 3 },
        marker: { size: 8 }
    }];

    const marketShareLayout = {
        title: { text: 'ì—°ê°„ ì‹œì¥ ì ìœ ìœ¨ ì¶”ì´ (%)', font: { size: 14 } },
        yaxis: { title: 'ì‹œì¥ ì ìœ ìœ¨ (%)' },
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 50, r: 30, b: 50, l: 60 },
        legend: { x: 0, y: 1, bgcolor: 'rgba(255,255,255,0.8)' }
    };

    if (document.getElementById('marketShareChart')) {
        Plotly.newPlot('marketShareChart', marketShareData, marketShareLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Competitor Positioning Chart
    const competitorData = [{
        x: [15, 25, 12, 30, 8],
        y: [85, 78, 90, 72, 88],
        mode: 'markers+text',
        type: 'scatter',
        text: ['ìš°ë¦¬íšŒì‚¬', 'ê²½ìŸì‚¬A', 'ê²½ìŸì‚¬B', 'ê²½ìŸì‚¬C', 'ê²½ìŸì‚¬D'],
        textposition: 'top center',
        marker: {
            size: [25, 20, 18, 22, 15],
            color: ['#6366f1', '#ef4444', '#f59e0b', '#10b981', '#8b5cf6']
        }
    }];

    const competitorLayout = {
        title: { text: 'ê²½ìŸì‚¬ í¬ì§€ì…”ë‹ (ë¸Œëœë“œ ì¸ì§€ë„ vs ì‹œì¥ ì ìœ ìœ¨)', font: { size: 14 } },
        xaxis: { title: 'ì‹œì¥ ì ìœ ìœ¨ (%)', range: [0, 35] },
        yaxis: { title: 'ë¸Œëœë“œ ì¸ì§€ë„ ì ìˆ˜', range: [65, 95] },
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 50, r: 30, b: 60, l: 70 }
    };

    if (document.getElementById('competitorChart')) {
        Plotly.newPlot('competitorChart', competitorData, competitorLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Performance Heatmap
    const heatmapData = [{
        z: [[85, 92, 78, 88, 75], [90, 88, 82, 85, 79], [78, 85, 90, 87, 83], [92, 89, 85, 91, 86], [80, 83, 88, 84, 81]],
        x: ['ì„±ì¥ë¥ ', 'ìˆ˜ìµì„±', 'ë¸Œëœë“œ', 'ê¸€ë¡œë²Œ', 'í˜ì‹ '],
        y: ['ì•„í‹°ìŠ¤íŠ¸A', 'ì•„í‹°ìŠ¤íŠ¸B', 'ì•„í‹°ìŠ¤íŠ¸C', 'ì•„í‹°ìŠ¤íŠ¸D', 'ì•„í‹°ìŠ¤íŠ¸E'],
        type: 'heatmap',
        colorscale: [
            [0, '#ff4444'], [0.5, '#ffaa00'], [1, '#00cc88']
        ],
        showscale: true,
        colorbar: {title: 'ì„±ê³¼ ì ìˆ˜'}
    }];

    const heatmapLayout = {
        title: { text: 'ì•„í‹°ìŠ¤íŠ¸ë³„ ë¶„ì•¼ë³„ ì„±ê³¼ ì ìˆ˜', font: { size: 16 } },
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 50, r: 30, b: 50, l: 80 }
    };

    if (document.getElementById('performanceHeatmapChart')) {
        Plotly.newPlot('performanceHeatmapChart', heatmapData, heatmapLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Revenue Chart
    const revenueData = [{
        x: ['Q1', 'Q2', 'Q3', 'Q4'],
        y: [145, 162, 178, 187],
        type: 'scatter',
        mode: 'lines+markers',
        fill: 'tozeroy',
        name: 'ë¶„ê¸° ë§¤ì¶œ',
        line: { color: '#6366f1', width: 3 },
        marker: { size: 10, color: '#ec4899' },
        fillcolor: 'rgba(99, 102, 241, 0.1)'
    }];

    const revenueLayout = {
        title: { text: 'ë¶„ê¸°ë³„ ë§¤ì¶œ ì¶”ì´ (ë‹¨ìœ„: ì‹­ì–µì›)', font: { size: 14 } },
        yaxis: { title: 'ë§¤ì¶œ (ì‹­ì–µì›)' },
        plot_bgcolor: 'rgba(0,0,0,0)',
        paper_bgcolor: 'rgba(0,0,0,0)',
        margin: { t: 50, r: 30, b: 50, l: 60 }
    };

    if (document.getElementById('revenueChart')) {
        Plotly.newPlot('revenueChart', revenueData, revenueLayout, {
            responsive: true, displayModeBar: false
        });
    }

    // Revenue Structure Chart
    const revenueStructureData = [{
        values: [58, 22, 12, 8],
        labels: ['ìŒì›/ìŠ¤íŠ¸ë¦¬ë°', 'MD/êµ¿ì¦ˆ', 'ê³µì—°/íˆ¬ì–´', 'ê´‘ê³ /í˜‘ì°¬'],
        type: 'pie',
        hole: 0.4,
        marker: {
            colors: ['#1db954', '#ff6b6b', '#4ecdc4', '#ffa726']
        },
        textinfo: 'label+percent',
        textposition: 'outside'
    }];

    const revenueStructureLayout = {
        title: { text: 'ë¶„ê¸° ë§¤ì¶œ êµ¬ì¡°', font: { size: 14 } },
        showlegend: false,
        margin: { t: 50, r: 30, b: 30, l: 30 }
    };

    if (document.getElementById('revenueStructureChart')) {
        Plotly.newPlot('revenueStructureChart', revenueStructureData, revenueStructureLayout, {
            responsive: true, displayModeBar: false
        });
    }
});
</script>
{% endblock %}